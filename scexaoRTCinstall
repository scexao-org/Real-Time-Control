#!/bin/bash

RTCDIR="${HOME}/Real-Time-Control"





# ==============================================================
# Deploy RTC scripts
# ==============================================================

cd ${HOME}
mkdir -p scexaoRTCbin
# populate scexaoRTCbin
cp ${RTCDIR}/scexaoRTCbin/* ${HOME}/scexaoRTCbin/

cd ${HOME}
mkdir -p scexaoRTCconf
# populate scexaoRTCconf
cp ${RTCDIR}/scexaoRTCconf/* ${HOME}/scexaoRTCconf/
cd ${HOME}/scexaoRTCconf
./confinstall
source ~/.profile

mkdir -p scexaoRTCsoft



exit


cd scexaoRTCbin

# compile and install setlatency executable
gcc -o setlatency ${RTCDIR}/scexaoRTCprogs/setlatency/setlatency.c





# ==============================================================
# REMOTE ACCESS, misc tools
# ==============================================================

# x2go
sudo apt install -y x2goserver
sudo apt install -y --no-install-recommends lxde
sudo apt install -y terminator

# To increase number of desktops etc...
sudo apt install -y wmctrl


# Misc convenience and tools
sudo apt install -y geany
sudo apt install -y gparted
sudo apt install -y iotop
sudo apt install -y numactl






# ==============================================================
# CACAO 
# ==============================================================

cd ${HOME}
sudo apt-get install -y cmake flex bison pkg-config
sudo apt-get install -y libcfitsio7 libcfitsio-dev libreadline-dev libfftw3-dev libgsl-dev libncurses5-dev 

mkdir -p src
cd src
git clone --recursive https://github.com/cacao-org/cacao cacao
cd cacao
git submodule foreach "(git checkout dev; git pull)"
git checkout dev; git pull
mkdir _build
cd _build
cmake ..
sudo make install
sudo ln -s /usr/local/bin/cacao /usr/local/bin/milk

# post installation

echo "/usr/local/lib" > usrlocal.conf
sudo mv usrlocal.conf /etc/ld.so.conf.d/
sudo ldconfig -v


echo "tmpfs /milk/shm tmpfs rw,nosuid,nodev" | sudo tee -a /etc/fstab
sudo mkdir -p /milk/shm
sudo mount /milk/shm




# ==============================================================
# DM driver
# ==============================================================



cd $HOME
mkdir -p src/DMoptical
cd src/DMoptical
rsync -au --progress /home/scexao/Real-Time-Control/scexaoRTCprogs/DMoptical/* .

# content was uncompressed by:
# tar -jxvf bmc_linux_sdk_2.2.tbz2
# Note: List of changes made to source code:

# In drv/bmc_mdrv.c
#- #include <asm/uaccess.h>
#+ #include <linux/uaccess.h>

#In drv/bmc_mdrv.c
#- #include <sys/ioctl.h>
#+ #include <linux/ioctl.h>

#In drv/bmc_mdrv.c
#+ #include <linux/uaccess.h>

#In lib/bmc_mdlib.c
#- #include <linux/ioctl.h>
#+ #include <sys/ioctl.h>

#In tool/bmc_ltest.c
+ #include <sys/time.h>



#Compile and install:

mkdir -p tmp
mkdir -p lib
cd src
make
cd ../bin
sudo insmod bmc_mdrv.ko
sudo chmod o+rw /dev/bmc_mdrv*



